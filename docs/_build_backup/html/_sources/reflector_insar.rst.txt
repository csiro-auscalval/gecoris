.. _reflector_insar:

********
CR InSAR
********

This module performs InSAR time series analysis
in a network of corner reflectors plus surrounding coherent point scatterers (PS).
It is following the steps in :ref:`insar_processing`.

This module assumes you have already prepared co-registered SLC stacks of your AOI using SNAP, see :ref:`snap_processing`.

.. note::

   It is recommended to perform InSAR analysis :ref:`insar_processing` of your AOI manually before using the automatic routines in this module.


Two-tracks example
------------------

Initialize already processed reflectors:

.. code:: python

   from gecoris import ioUtils

   station_log = '/data/GUDS/CR_VYCHOD/CR_Presov.csv'
   stacks_log = '/data/GUDS/CR_VYCHOD/input_stacks_VYCHOD.csv'
   process_dir = '/data/GUDS/CR_VYCHOD/gecoris'

   stations, refl_flag = ioUtils.load_stations(station_log, process_dir)

Define full paths to the results of InSAR analysis:

.. code:: python

   hdf_files = [
       '/data/GUDS/CR_VYCHOD/insar_Presov/insar_ASC102.hdf5',
       '/data/GUDS/CR_VYCHOD/insar_Presov/insar_DSC153.hdf5']

   stack_ids = [
       's1_asc102',
       's1_dsc153']

Extract InSAR time series for reflectors:

.. code:: python

   for i in range(len(stations)):
       for stackId, hdf in zip(stack_ids, hdf_files):
           stations[i].add_insar_ts(hdf, stackId)

Finally, perform LOS decomposition into vertical and east-west components and plot the time series:

.. code:: python

   decomp = True
   for i in range(len(stations)):
       # plot TS:
       stations[i].plot_insar_ts(out_dir = '/data/GUDS/CR_VYCHOD/insar_Presov')
       if decomp:
           stations[i].decomp_insar_ts()
           stations[i].plot_decomp_ts(
               out_dir = '/data/GUDS/CR_VYCHOD/insar_Presov')


Automatic routines
------------------

One should first use :ref:`reflector_monitoring` module to perform reflectivity time series analysis of the network of CR.

Then, all required parameters are automatically parsed from respective ``gecoris.parms`` and analysis is performed for all available stacks using:

.. code:: shell

   python gecoris/CR_insar.py gecoris.parms


.. warning::

   It is highly recommended to modify default ``insar.parms`` parameters in a second iteration for your AOI's specifics.


All data and results of InSAR processing are sequentially stored in binary HDF and human-readable CSV formats.


TBA
